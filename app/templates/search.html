{% extends "base.html" %} 
{% block title %}B칰squeda de Contrase침a{% endblock%} 
{% block content %}

<form action="/view" method="GET" class="search-form">
  <input type="text" name="filter" placeholder="Buscar cuenta" class="search-input" />
  <button type="submit" class="search-button">游댌</button>
</form>
<table class="password-table">
  <thead>
    <tr>
      <th>CUENTA</th>
      <th>CONTRASE칌A</th>
      <th>ACCIONES</th>
    </tr>
  </thead>
  <tbody>
    {% for id, account_name, password in data %}
    <tr>
      <td>{{ account_name }}</td>
      <td>{{ password }}</td>
      <td>
          <button type="submit" class="config-button" onclick="copyDecryptedPassword('{{ id }}')">游늶</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<script>
  async function copyDecryptedPassword(passwordId) {
    try {
      // Llamar a la API para desencriptar la contrase침a
      const response = await fetch('/decrypt', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ password_id: passwordId }),
      });

      const data = await response.json();

      if (response.ok) {
        // Copiar la contrase침a desencriptada al portapapeles
        await navigator.clipboard.writeText(data.password);
        alert('Contrase침a copiada al portapapeles');
      } else {
        alert(data.error || 'Error al copiar la contrase침a');
      }
    } catch (error) {
      alert(`Error al comunicarse con el servidor ${error.message}`);
    }
  }
</script>
{% endblock %}